<!DOCTYPE html>
<html>
  <head>
    <title>smooth loader</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script>
        // perform our complicated JS while we load
        function churn() {
            for(var i=0; i<10; i++) {
              // burn some CPU time
              console.log('flail!');
              var start = new Date().getTime();
              while(new Date().getTime() - start < 200) {
                ;
              }
            }
          }

        // initiate the animation
        function startCSS() {
          var el = document.querySelector('img');
          el.style.webkitAnimationName = 'swipy';
        }

        function startRAF() {
          // animation duration in ms
          var duration = 5*1000;
          // translateX offset in px
          var offset = 250;
          var startTime = null;
          // make sure we start at the offset
          var el = document.querySelector('img');
//          el.style.webkitTransform = "translateX(-" + offset + "px)";
          function update(timestamp) {
            if(!startTime)
              startTime = timestamp;
            var new_x = offset - (((timestamp - startTime) / duration) * offset);
            //if(new_x >= offset) {
            //  console.log('done');
            //}
            //else {
              el.style.webkitTransform = "translateX(-" + new_x + "px)";
              window.webkitRequestAnimationFrame(update);
            //}
          }
          window.webkitRequestAnimationFrame(update);
        }


        $(document).ready(function() {
        });

    </script>
    <style>
        img {
          -webkit-animation-duration: 5s;
          -webkit-animation-fill-mode: forwards;
          -webkit-transform: translateX(-250px);
          -webkit-animation-timing-function: linear;
        }
        @-webkit-keyframes swipy {
            from {
                -webkit-transform: translateX(-250px);
            }
            to {
                -webkit-transform: translateX(0px);
            }
        }
    </style>
    </head>
  <body style="-webkit-transform:translateZ(0)">
    <img id="foo" src="chrome-logo.png" width="250" onload="startCSS()">
    <p>Loading...</p>
    <input type="button" onclick="churn()" value="churn">
</body>
</html>

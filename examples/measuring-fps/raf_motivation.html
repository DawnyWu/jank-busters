<!DOCTYPE html>
<html>
  <head>
    <title>Why rAf Matters</title>
    <style>
      * {
        font-family: 'Open Sans', Arial, sans-serif;
        font-size: 16pt;
        color: #797979;
      }
      h1 {
        font-size: 16pt;
      }
      #a, #b, #c {
        margin-bottom: 40px;
      }
      div.label {
        margin-bottom: 0.2em;
      }

    </style>
    <script>
      var noise = [0.504089951980859,0.5577280609868467,0.7220653020776808,0.809325227048248,0.05936638778075576,0.5019259338732809,0.009001224068924785,0.3913198192603886,0.19024858018383384,0.36960490443743765,0.5441001320723444,0.6949236935470253,0.8717413479462266,0.09284356166608632,0.6315366718918085,0.7207315757405013,0.15402286499738693,0.7427600868977606,0.642497296212241,0.6551153126638383,0.3538989822845906,0.4852088119369,0.9833883927203715,0.18848598841577768,0.5396600966341794,0.4369537846650928,0.46386138000525534,0.4198951139114797,0.20559638808481395,0.43202422745525837,0.9379704156890512,0.18474676506593823,0.563667758135125,0.3743672992568463,0.8048065884504467,0.29113367409445345,0.37587120407260954,0.7506159688346088,0.9789784660097212,0.19444568967446685,0.7676971151959151,0.5837630019523203,0.4931766085792333,0.3602669558022171,0.6398860770277679,0.3119622024241835,0.7850665054284036,0.7089537552092224,0.10832746978849173,0.01055849646218121,0.5581018370576203,0.06713706534355879,0.28350590192712843,0.037091217236593366,0.34223692724481225,0.4549455812666565,0.7694942376110703,0.4878475775476545,0.17227067495696247,0.08145877299830317,0.06125797308050096,0.5943163374904543,0.07877609645947814,0.3847344699315727,0.8274990129284561,0.48685351852327585,0.9951957408338785,0.5106796303298324,0.47833754983730614,0.4169470863416791,0.11777455592527986,0.07878640992566943,0.8336692482698709,0.04639650695025921,0.36904770717956126,0.5601849488448352,0.22656533704139292,0.08721317071467638,0.6353415416087955,0.28570498269982636,0.27643747185356915,0.7934663440100849,0.028011605609208345,0.5145006065722555,0.4722568206489086,0.7946490889880806,0.41266113007441163,0.4382499458733946,0.6861341886688024,0.44881880353204906,0.2902275456581265,0.8260309300385416,0.41458589234389365,0.4850093100685626,0.5149987256154418,0.8008532740641385,0.8361632800661027,0.9748542185407132,0.14497717120684683,0.7498968229629099,0.920448963297531,0.9744552012998611,0.4766839074436575,0.13036092394031584,0.4280218312051147,0.0045255019795149565,0.5815579805057496,0.19949823943898082,0.6687419898808002,0.8715948606841266,0.8790741984266788,0.6986959371715784,0.4619983418378979,0.9187529888004065,0.8053300778847188,0.7835049154236913,0.24290111660957336,0.46683672443032265,0.2940920414403081,0.512866910547018,0.06081852316856384,0.9772861602250487,0.12237841635942459,0.7427317986730486,0.0760508025996387,0.09840361773967743,0.08651770930737257,0.8890298791229725,0.4821232834365219,0.5313247232697904,0.14156482252292335,0.44853900745511055,0.04988013091497123,0.8335182026494294,0.040976724587380886,0.45621644076891243,0.827899859752506,0.47740279720164835,0.8456429014913738,0.5919444668106735,0.1736497136298567,0.4137588848825544,0.47986971167847514,0.411715290741995,0.5513485199771821,0.8691396999638528,0.5133049581199884,0.09791064634919167,0.007273673079907894,0.5383936951402575,0.4772808188572526,0.46466021286323667,0.7208952074870467,0.5472194140311331,0.8364431415684521,0.783551019616425,0.32129609724506736,0.3258893450256437,0.05326722306199372,0.9072839706204832,0.9220511582680047,0.9463403068948537,0.32597346184775233,0.621675593778491,0.735276950057596,0.17331941542215645,0.877238841028884,0.25427503208629787,0.6879452532157302,0.6472402825020254,0.21465650643222034,0.9076747922226787,0.7981940668541938,0.430309807183221,0.10813699825666845,0.9355346958618611,0.5523427745793015,0.9296302224975079,0.7016577685717493,0.289106935961172,0.5664811334572732,0.35850042081438005,0.10761770885437727,0.017270877258852124,0.8221515703480691,0.005166366696357727,0.1929246848449111,0.26522819860838354,0.2503069450613111,0.02311707683838904,0.6514847779180855,0.4028935788664967,0.508698979858309,0.9722503828816116,0.6536070869769901,0.7725879100617021,0.3536564353853464,0.08088726713322103,0.1680035679601133,0.9669971300754696,0.85235784528777,0.43507125158794224,0.8374636303633451,0.8517045176122338,0.8974360169377178,0.7455937871709466,0.6413203841075301,0.04708337434567511,0.8624973562546074,0.8752165790647268,0.9205182762816548,0.1247161184437573,0.5961018062662333,0.230969971511513,0.6076010551769286,0.35434719547629356,0.06989526702091098,0.2755898872856051,0.1191745181567967,0.9244050532579422,0.013979518553242087,0.24217366869561374,0.7293399767950177,0.30209078011102974,0.6200827467255294,0.5218264563009143,0.77572061563842,0.54545156378299,0.2749334732070565,0.8441048297099769,0.09545521973632276,0.3026955774985254,0.3174580754712224,0.9979175194166601,0.44258479215204716,0.9655466359108686,0.649740912951529,0.019166210666298866,0.9657300014514476,0.18049850780516863,0.19783123303204775,0.09540684497915208,0.19221238582395017,0.4645485491491854,0.41079041943885386,0.7479357873089612,0.16570306266658008,0.19003484421409667,0.6123041892424226,0.5692219859920442,0.009534688899293542,0.21450936351902783,0.3598536769859493,0.24304542085155845,0.5793505655601621,0.11533106281422079,0.23340535233728588,0.50359714217484,0.1704785185866058,0.4634312754496932,0.9567663269117475,0.9135930447373539,0.32821011752821505,0.3905054002534598,0.43186043365858495,0.5739111902657896,0.534038475016132,0.7978063013870269,0.4252247412223369,0.5385264721699059,0.6608920989092439,0.09301344444975257,0.779190928908065,0.9977363129146397,0.5042743587400764,0.8609576532617211,0.9112052978016436,0.31703630345873535,0.08166952570900321,0.07482014666311443,0.16586442827247083,0.06939090718515217,0.6492317016236484,0.8710738767404109,0.6027413883712143,0.3789098053239286,0.6960986128542572,0.7133355194237083,0.9424748560413718,0.09796305443160236,0.10281884646974504,0.1848261954728514,0.5855339716654271,0.5804341146722436,0.007335316855460405,0.5790552131365985,0.3096108220051974,0.9686010386794806,0.37743061501532793,0.37953975796699524,0.901520430110395,0.47818661970086396,0.9468095263000578,0.7760472551453859,0.37987640290521085,0.3800543346442282,0.5457643431145698,0.39253003522753716,0.08817215566523373,0.17779236380010843,0.5315961039159447,0.8664280525408685,0.22573364665731788,0.8372551763895899,0.09890741622075438,0.012042243732139468,0.3922710793558508,0.12959594069980085,0.09066717862151563,0.24985188245773315,0.9294327641837299,0.9229107939172536,0.775738874450326,0.2846332751214504,0.7282210625708103,0.9598053304944187,0.333986624609679,0.07763759884983301,0.40035294205881655,0.2730718713719398,0.4144953724462539,0.3093295837752521,0.0433058668859303,0.03982830583117902,0.46351187862455845,0.31446649320423603,0.6024039213079959,0.5078082473482937,0.22873743809759617,0.15352271916344762,0.6135248206555843,0.7951966761611402,0.9079341082833707,0.21215745434165,0.11384883103892207,0.6668977877125144,0.8311928070615977,0.8318184460513294,0.16998734534718096,0.42348867165856063,0.5775758365634829,0.6826669033616781,0.6128731605131179,0.8836385968606919,0.4828312136232853,0.33159675914794207,0.005800063721835613,0.2787745320238173,0.4451878739055246,0.09541704528965056,0.9823305427562445,0.11978296842426062,0.2046951767988503,0.8280204273760319,0.6137579781934619,0.9565578303299844,0.6337709156796336,0.600142304552719,0.4703134037554264,0.3382240349892527,0.10565948579460382,0.39183404692448676,0.48809423786588013,0.8311116928234696,0.10903026140294969,0.24319077795371413,0.9490771985147148,0.4643996977247298,0.04271473549306393,0.06954835378564894,0.9151571588590741,0.590528740780428,0.09887025435455143,0.1764767193235457,0.27689821808598936,0.26713294815272093,0.8479101955890656,0.17187020904384553,0.1415358129888773,0.8603736294899136,0.9359596474096179,0.1508812594693154,0.9227073777001351,0.35223587905056775,0.4012191907968372,0.7546429056674242,0.7349065504968166,0.3551261192187667,0.3253852999769151,0.21007216884754598,0.6131204976700246,0.8403799231164157,0.22642100020311773,0.8650255734100938,0.20997205702587962,0.7876847968436778,0.6140921455807984,0.009746451862156391,0.015240751905366778,0.4780750914942473,0.6782309175468981,0.16858195792883635,0.5197404611390084,0.4268755428493023,0.016334601445123553,0.9029244596604258,0.6104352080728859,0.8909070061054081,0.7144092139787972,0.02647422277368605,0.4706307337619364,0.45178039418533444,0.670517748920247,0.42492003086954355,0.29920443682931364,0.6980461273342371,0.6593967974185944,0.30068973382003605,0.5305646357592195,0.5224331463687122,0.6007761515211314,0.9407837558537722,0.32628232310526073,0.2662823034916073,0.2474926351569593,0.31833708053454757,0.15428850706666708,0.06766251940280199,0.37210889137350023,0.027948428876698017,0.9332157992757857,0.9396070197690278,0.5768940218258649,0.2795019131153822,0.9182848799973726,0.041198986349627376,0.8016411324497312,0.9240788251627237,0.4186789062805474,0.9583234216552228,0.8532241289503872,0.8135087999980897,0.21487636491656303,0.5090712883975357,0.775111869443208,0.45863496023230255,0.36554394918493927,0.1032983548939228,0.9726398489437997,0.20822772150859237,0.6833018537145108,0.5234551816247404,0.6971877610776573,0.03810103819705546,0.37201446015387774,0.5800064017530531,0.07102542696520686,0.25028830021619797,0.8992652886081487,0.5488667292520404,0.13852201378904283,0.1765780251007527,0.030641492689028382,0.09105493128299713,0.7505118669942021,0.39014453417621553,0.09106102702207863,0.5021769176237285,0.6184202902950346,0.9766491113696247,0.4037013913039118,0.30738073540851474,0.5841241229791194,0.12634646147489548,0.778791670454666,0.5484964132774621,0.6920362967066467,0.17523700022138655,0.9272398587781936,0.7273578990716487,0.7581135218497366,0.21272427355870605,0.10974450246430933,0.3846137961372733,0.8387851992156357,0.32856465550139546,0.7128946261946112,0.8237575157545507,0.6847767936997116,0.740974803455174,0.8195822997950017,0.9463413525372744,0.01860282151028514,0.9651409976650029,0.0032787492964416742,0.5192200853489339,0.27339198463596404,0.09382339799776673,0.6579261450096965,0.5741993738338351,0.8250334998592734,0.7187980918679386,0.1699633663520217,0.6707838475704193,0.43484862172044814,0.3712321729399264,0.3070782166905701,0.3471161862835288,0.7538591276388615,0.22098900377750397,0.7887009151745588,0.019501172238960862,0.13856570539064705,0.795756058068946,0.46464930078946054,0.391431646887213,0.9902158023323864,0.8663365228567272,0.7744775395840406,0.42942209797911346,0.34796481556259096,0.09917444991879165,0.8944468926638365,0.8863357962109149,0.49493847228586674,0.37000228581018746,0.9025984974578023,0.3416786743327975,0.21630675066262484,0.5869249000679702,0.0318926814943552,0.8599278402980417,0.3073828797787428,0.5477857096120715,0.38617216935381293,0.47065700590610504,0.1338411837350577,0.9982088881079108,0.7587668707128614,0.6959071208257228,0.7763380529358983,0.39842105912975967,0.7087172763422132,0.7243500929325819,0.11740460176952183,0.42713436856865883,0.9926865748129785,0.9063251037150621,0.7118905445095152,0.0945770360995084,0.37286255322396755,0.5584029147867113,0.60524583584629,0.15822052164003253,0.9447776456363499,0.4638350596651435,0.21294117718935013,0.1162012992426753,0.09394015488214791,0.7052824134007096,0.8343907969538122,0.32583761191926897,0.8022160190157592,0.5290528452023864,0.9192988590802997,0.2799350991845131,0.4722769963555038,0.07776516303420067,0.7392111665103585,0.9341533354017884,0.006803394295275211,0.7097294884733856,0.01751581742428243,0.8694666863884777,0.35919073899276555,0.9483004598878324,0.7888063341379166,0.19817295740358531,0.956810857867822,0.257875835057348,0.7216870584525168,0.05811088066548109,0.9865653298329562,0.6223893805872649,0.16360614076256752,0.5378990906756371,0.15614955406636,0.5877050501294434,0.374557628063485,0.01798098860308528,0.34981567738577724,0.6524239860009402,0.12959785922430456,0.8843594510108232,0.1498915944248438,0.3665406000800431,0.140747714554891,0.415820493362844,0.9724989540409297,0.8797848899848759,0.9709800835698843,0.40558268828317523,0.6011238291393965,0.9725931114517152,0.09231251082383096,0.7373027994763106,0.24871065700426698,0.5464576431550086,0.1818328807130456,0.9900775454007089,0.019624845357611775,0.07676902203820646,0.48945845011621714,0.32535125059075654,0.8534118682146072,0.6343889988493174,0.14256153092719615,0.7402330334298313,0.9363591757137328,0.29709354508668184,0.502379234880209,0.02174168941564858,0.6973395708482713,0.12877797754481435,0.8403854451607913,0.5793180444743484,0.7939796738792211,0.8954104378353804,0.7156494036316872,0.10042779636569321,0.581696319160983,0.15383928478695452,0.1248560540843755,0.37968119443394244,0.20111452648416162,0.44663143320940435,0.2134658140130341,0.6611368940211833,0.7423602510243654,0.32538118143565953,0.760341796791181,0.9939021475147456,0.3051210446283221,0.9706700651440769,0.6688752777408808,0.5960151180624962,0.7794571225531399,0.3900905812624842,0.7747264048084617,0.24576363572850823,0.46504425327293575,0.2542856279760599,0.6427373527549207,0.4224992599338293,0.028167494339868426,0.26899135019630194,0.6556123786140233,0.3115443161223084,0.26116006867960095,0.9071218897588551,0.6341197115834802,0.1387266165111214,0.47654710011556745,0.8302440878469497,0.11898399540223181,0.9422949955333024,0.8652088176459074,0.7554880038369447,0.6419528040569276,0.6210161028429866,0.9733421152923256,0.6208599186502397,0.7198234749957919,0.8398689907044172,0.14881890057586133,0.6970363112632185,0.07568923896178603,0.4636152246966958,0.9974042067769915,0.42155773052945733,0.8855592575855553,0.9098236090503633,0.4388818214647472,0.42005826183594763,0.9868741589598358,0.7421656316146255,0.4429789618588984,0.3768991914112121,0.6832466351334006,0.431043571094051,0.8778832894749939,0.5246552543248981,0.47558996616862714,0.13871891680173576,0.6414343907963485,0.24788363720290363,0.9055763327050954,0.6085919286124408,0.014524814439937472,0.9129807204008102,0.28519025235436857,0.10707437386736274,0.2379668008070439,0.009025606326758862,0.5724746028427035,0.3005581786856055,0.06659509567543864,0.1740550510585308,0.9348891447298229,0.48743694415315986,0.6901520057581365,0.8628870195243508,0.5827946693170816,0.09327133186161518,0.4974314614664763,0.7365292052272707,0.047849224181845784,0.6908105972688645,0.21769975125789642,0.4057517503388226,0.946045181248337,0.37229151045903563,0.47935119131579995,0.19896029401570559,0.439043739810586,0.19511587265878916,0.3974414288531989,0.911041859537363,0.6783905355259776,0.7987310409080237,0.49787380872294307,0.3220759138930589,0.675348196644336,0.7758786545600742,0.5856195669621229,0.3484549783170223,0.7165969500783831,0.8864672547206283,0.2335701894480735,0.8553790126461536,0.9256360025610775,0.5251853694207966,0.5506795383989811,0.8416275531053543,0.07258711569011211,0.48445552098564804,0.8002426913008094,0.11701696901582181,0.24445898062549531,0.16340901935473084,0.6442551554646343,0.9765898527111858,0.8077086957637221,0.738530159695074,0.24202830903232098,0.2825222734827548,0.03204515902325511,0.5632730110082775,0.1520418191794306,0.9397122538648546,0.10172093543224037,0.34419220220297575,0.5806621457450092,0.6103716294746846,0.7795551870949566,0.5549599097575992,0.42562086833640933,0.23226244770921767,0.16625417512841523,0.43245501606725156,0.9673052341677248,0.1540226535871625,0.811532209161669,0.563705954933539,0.061197178438305855,0.19521884131245315,0.21971413656137884,0.7694014634471387,0.09785592090338469,0.9633966255933046,0.6818315447308123,0.03660995699465275,0.3217775379307568,0.24908454320393503,0.2617961298674345,0.7638584158848971,0.4086016493383795,0.5413775655906647,0.16892041685059667,0.521912784781307,0.5320012134034187,0.21180429542437196,0.7354864608496428,0.5202225507237017,0.2981446839403361,0.6252139171119779,0.48431732994504273,0.5145909052807838,0.27242772886529565,0.3872318665962666,0.7721200571395457,0.7054863551165909,0.787599130300805,0.5216708986554295,0.0342275770381093,0.36238187714479864,0.7804542884696275,0.14553840411826968,0.663659411482513,0.9384752023033798,0.45053791906684637,0.6585794440470636,0.2448573203291744,0.12147878180257976,0.297036818228662,0.1598826798144728,0.11120986426249146,0.9734369204379618,0.15165420155972242,0.5258201225660741,0.3243207361083478,0.5308340266346931,0.24489742331206799,0.9920449499040842,0.35404019011184573,0.32174520031549037,0.9193603007588536,0.337428052444011,0.28968102554790676,0.6178938178345561,0.6465158690698445,0.881294367602095,0.483632073039189,0.03895279602147639,0.7871624063700438,0.6681309642735869,0.7430507284589112,0.9440801793243736,0.3586414463352412,0.1405704494100064,0.9282844515983015,0.46855048136785626,0.5043884362094104,0.17721058172173798,0.05235174694098532,0.9272892780136317,0.45985383237712085,0.8774298767093569,0.028587764594703913,0.7149902144446969,0.7995896995998919,0.8192492795642465,0.8285385372582823,0.8468935866840184,0.6472294994164258,0.42252156790345907,0.5870880482252687,0.5291045024059713,0.8352232549805194,0.47256477433256805,0.6696853451430798,0.8165416668634862,0.6496111936867237,0.4682019839528948,0.9440154586918652,0.5394076332449913,0.1408520496916026,0.8580998075194657,0.8092519042547792,0.6575722540728748,0.1516063460148871,0.29835069784894586,0.938013656064868,0.33250397350639105,0.677115750266239,0.26178784924559295,0.5346882329322398,0.7940631958190352,0.13766430225223303,0.21255140868015587,0.7061568121425807,0.34221090748906136,0.9444558003451675,0.6598204954061657,0.2461599970702082,0.403623168123886,0.6398362054023892,0.9057876779697835,0.6911152652464807,0.10312867676839232,0.4387368692550808,0.1736306573729962,0.5104146124795079,0.20629345253109932,0.28316206601448357,0.8023621740285307,0.3053977941162884,0.4481596585828811,0.19464395171962678,0.45349798910319805,0.17037196946330369,0.6371351487468928,0.3495435093063861,0.45774603681638837,0.0992057763505727,0.7615129614714533,0.7729552171658725,0.5178201734088361,0.3241378727834672,0.32215823978185654,0.8816460552625358,0.8061409452930093,0.6902621248736978,0.18237502151168883,0.6495908219367266,0.7337119323201478,0.5775503716431558,0.6994913162197918,0.5979366370011121,0.919778132578358,0.7335496286395937,0.4464055944699794,0.6675485852174461,0.9133480954915285,0.08931938698515296,0.44390276074409485,0.039593473076820374,0.3928698617964983,0.15082674589939415,0.07422443968243897,0.823059247341007,0.6110802448820323,0.370113268494606,0.026162216905504465,0.9376178770326078,0.3101133687887341,0.990930846426636,0.366599481087178,0.9328943705186248,0.7363933792803437,0.24158765887841582,0.47488399175927043,0.6065687155351043,0.6714453487657011,0.3368935526814312,0.2526173230726272,0.07578557333908975,0.0823612513486296,0.27584502636455,0.5141358061227947,0.43132693879306316,0.1980632683262229,0.1842033015564084,0.18034209730103612,0.634004620835185,0.4025394406635314,0.021220951806753874,0.9803675757721066,0.7822623928077519,0.35844089975580573,0.4010207843966782,0.13169828499667346,0.9434648484457284,0.3381650373339653,0.9587501473724842,0.2652318887412548,0.3485359016340226,0.30017063091509044,0.24266973324120045,0.9406194484326988,0.6473207108210772,0.26097646285779774,0.3760091217700392,0.46074437559582293,0.5925840134732425,0.9163374167401344,0.8573011939879507,0.03868009732104838,0.08164941403083503,0.23050011997111142,0.8902830136939883,0.3616432351991534,0.9144371328875422,0.42788423248566687,0.7378722249995917,0.1466832747682929,0.3303065123036504,0.4211312532424927,0.031943405978381634,0.8592897967901081];
    </script>
  </head>
  <body>
    <div id="a">
      <div class="label">
        <label for="display-refresh">Display refresh rate:</label>
        <input id="display-refresh" type="range" min="50" max="70" value="60" step="1"></input>
        (<span id="cur-display-refresh">xxx</span> Hz)
      </div>
      <canvas id="canvas0" width="5000" height="40"></canvas>
    </div>

    <div id="b" style="display:block">
      <div class="label">
        <label for="interval">setTimeout interval:</label>
        <input id="interval" type="range" min="6" max="20" value="16" step="0.1"></input>
        (<span id="cur-interval">xxx</span> ms)
        <span>&nbsp;&nbsp;&nbsp;&nbsp;</span>

      </div>
      <canvas id="canvas1" width="5000" height="60"></canvas>
    </div>

    <div id="c" style="display:block">
      <div class="label">
        <label>requestAnimationFrame:</label>
      </div>
      <canvas id="canvas2" width="5000" height="60"></canvas>
    </div>

<!--
    <input id="noise" type="checkbox"><label for="noise">5% Noise</label></label>
-->

    <script>
      function line(ctx, x1, y1, x2, y2, color) {
        ctx.strokeStyle = color;
        ctx.beginPath();
        ctx.moveTo(x1,y1);
        ctx.lineTo(x2,y2);
        ctx.stroke();
      }
      function arrow(ctx, x1, y1, x2, y2, color) {
        line(ctx, x1, y1, x2, y2, color);
        var dx = x2 - x1;
        var dy = y2 - y1;
        var len = Math.sqrt(dx * dx + dy * dy);
        var perc = (len - 10) / len;
        var bx = x1 + perc * dx;
        var by = y1 + perc * dy;
        var ux = dx / len;
        var uy = dy / len;
        var ax = uy * 5;
        var ay = -ux * 5;
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.moveTo(bx + ax, by + ay);
        ctx.lineTo(x2, y2);
        ctx.lineTo(bx - ax, by - ay);
        ctx.lineTo(bx + ax, by + ay);
        ctx.fill();
      }

      function niceRect(ctx, x, y, w, h, text) {
        ctx.fillStyle = 'rgba(255,255,255,0.75)';
        ctx.fillRect(x, y, w, h);

        ctx.strokeStyle = 'rgba(0,0,0,1)';
        ctx.strokeRect(x, y, w, h);

        var tw = ctx.measureText(text).width;
        ctx.textBaseline = 'middle';
        ctx.fillStyle = 'rgba(0,0,0,1)';
        ctx.fillText(text, x + 0.5 * w - 0.5 * tw, y + 0.5 * h);
      }

      function redraw() {
        var canvas0 = document.querySelector('#canvas0');
        var w = canvas0.width;
        var h0 = canvas0.height;

        var ctx0 = canvas0.getContext('2d');
        ctx0.clearRect(0, 0, w, h0);


        var canvas1 = document.querySelector('#canvas1');
        if (canvas1.width != canvas0.width)
          canvas1.width = canvas0.width;
        var h = canvas1.height;
        var ctx = canvas1.getContext('2d');
        ctx.clearRect(0, 0, w, h);


        var canvas2 = document.querySelector('#canvas2');
        if (canvas2.width != canvas0.width)
          canvas2.width = canvas0.width;
        var ctx2 = canvas2.getContext('2d');
        ctx2.clearRect(0, 0, w, h);


        var px_per_ms = 60 / (1000 / 60);
        var cur_vsync = document.querySelector('#display-refresh').value;
        document.querySelector('#cur-display-refresh').textContent = cur_vsync;
        var vsync_width = (1000 / cur_vsync) * px_per_ms;

        var N = Math.ceil(w / vsync_width);
        var current_interval = document.querySelector('#interval').value;
        document.querySelector('#cur-interval').textContent = current_interval;

        var cur_interval_width = current_interval * px_per_ms;
        var M = Math.ceil(w / cur_interval_width);

        for (var i = 0; i < N; i++)
          line(ctx0, i*vsync_width, 0, i*vsync_width, h, 'rgba(0,0,255,1.0)');

        for (var i = 0; i < N; i++)
          line(ctx, i*vsync_width, 0, i*vsync_width, h, 'rgba(0,0,255,1.0)');

        for (var i = 0; i < N; i++)
          line(ctx2, i*vsync_width, 0, i*vsync_width, h, 'rgba(0,0,255,1.0)');

        ctx.stroke();
        ctx.fillStyle = 'rgba(0,0,0,1)';
        ctx.textBaseline = 'top';
        if (current_interval < 14)
          ctx.font = '10px sans-serif';
        else
          ctx.font = '16px sans-serif';
        //ctx.fillText('display refreshes', 0, 0);

        //arrow(ctx,50,20, vsync_width * 1, 30, 'rgba(0,0,255,0.75)');
        //arrow(ctx,50,20, vsync_width * 2, 30, 'rgba(0,0,255,0.75)');
        //arrow(ctx,50,20, vsync_width * 5, 30, 'rgba(0,0,255,0.75)');

        for (var i = 0; i < M; i++) {
          var doneAt = (i+1)*cur_interval_width - 4;
          var nearestVSync = Math.ceil(doneAt / vsync_width) * vsync_width;

          var nextDoneAt = (i+2)*cur_interval_width - 4;
          var nextNearestVSync = Math.ceil(nextDoneAt / vsync_width) * vsync_width;

          var c;
          if (nearestVSync == nextNearestVSync)
            c = 'rgba(255, 0, 0, 0.75)';
          else
            c = 'rgba(0, 0, 0, 0.75)';

          if (current_interval < 10.5)
            suffix = ''
          else
            suffix = 'ms';
          niceRect(ctx, i*cur_interval_width, 15, cur_interval_width - 4, 30, current_interval + suffix);
          arrow(ctx, doneAt, 150+30, nearestVSync, 200, c);

          if (nearestVSync == nextNearestVSync) {
            ctx.lineWidth = 3;
            line(ctx, i*cur_interval_width, 15, i*cur_interval_width + cur_interval_width - 4, 45, 'rgba(255, 0, 0, 0.75)');
            line(ctx, i*cur_interval_width, 45, i*cur_interval_width + cur_interval_width - 4, 15, 'rgba(255, 0, 0, 0.75)');
            ctx.lineWidth = 1;
          }
        }

        for (var i = 0; i < M; i++) {
          niceRect(ctx2, i*vsync_width + 2, 15, vsync_width - 5, 30, 'raf');
          arrow(ctx2, doneAt, 150+30, nearestVSync, 200, c);
        }

      }

      redraw();
      document.querySelector('#display-refresh').addEventListener('change', redraw);
      document.querySelector('#interval').addEventListener('change', redraw);
    </script>
  </body>
</html>
